<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="EduSummarizer ‚Äî AI-powered study workspace for notes, summaries and flashcards.">
    <title>EduSummarizer | AI Workspace</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üß†</text></svg>">

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Third-party scripts ‚Äî all deferred so they don't block page render -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js" defer></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>

    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <!-- ==================== LOGIN SCREEN ==================== -->
    <div id="loginScreen" class="login-container">
        <div class="ambient-blob blob-purple"></div>
        <div class="ambient-blob blob-blue"></div>
        <div class="ambient-blob blob-indigo"></div>

        <div class="login-card glass-panel">
            <div class="login-logo floating">
                <i class="fa-solid fa-brain"></i>
            </div>

            <h2 id="authTitle">EduSummarizer</h2>
            <p id="authSubtitle">Sign in to your AI Workspace</p>

            <div class="input-group">
                <i class="fa-solid fa-user"></i>
                <input type="text" id="loginUser" placeholder="Email" autocomplete="off">
            </div>

            <div class="input-group">
                <i class="fa-solid fa-lock"></i>
                <input type="password" id="loginPass" placeholder="Password">
            </div>

            <div class="input-group hidden" id="confirmPasswordGroup">
                <i class="fa-solid fa-lock"></i>
                <input type="password" id="confirmPass" placeholder="Confirm Password">
            </div>

            <!-- Moved inline styles to CSS classes: .login-footer-row, .toggle-auth-btn -->
            <div class="login-footer-row">
                <label class="remember-label">
                    <input type="checkbox" id="rememberMe" class="remember-checkbox">
                    Remember Me
                </label>
                <button id="toggleAuthMode" class="toggle-auth-btn">Create Account</button>
            </div>

            <button id="loginSubmitBtn" class="login-btn fluid-gradient">
                Enter Workspace <i class="fa-solid fa-arrow-right"></i>
            </button>

            <p id="loginError" class="login-msg hidden">Invalid Credentials</p>
        </div>
    </div>

    <!-- ==================== MAIN APP ==================== -->
    <div class="app-container hidden" id="appContainer">

        <aside class="sidebar" id="sidebar">
            <div class="logo-section">
                <i class="fa-solid fa-brain logo-icon"></i>
                <h2>EduSummarizer</h2>
            </div>

            <nav class="nav-menu">
                <button class="nav-btn active" id="newNoteBtn">
                    <i class="fa-solid fa-plus"></i> New Note
                </button>

                <div class="nav-section">
                    <button class="nav-btn" id="historyToggle">
                        <i class="fa-solid fa-clock-rotate-left"></i> History
                    </button>
                    <div id="historyList" class="nav-list" style="display: none;"></div>
                </div>

                <div class="nav-section">
                    <button class="nav-btn" id="savedToggle">
                        <i class="fa-solid fa-bookmark"></i> Saved Notes
                    </button>
                    <div id="savedList" class="nav-list" style="display: none;"></div>
                </div>

                <!-- NEW: Saved Decks button -->
                <div class="nav-section">
                    <button class="nav-btn saved-decks-btn" id="savedDecksToggle">
                        <i class="fa-solid fa-layer-group"></i> Saved Decks
                    </button>
                    <div id="savedDecksList" class="nav-list" style="display: none;"></div>
                </div>

                <button class="nav-btn clear-history-btn" id="clearHistoryBtn">
                    <i class="fa-solid fa-trash-can"></i> Clear History
                </button>
            </nav>

            <div class="sidebar-bottom">
                <div class="user-section" id="userSection">
                    <div class="dropup-menu" id="dropupMenu">
                        <button class="nav-btn" id="settingsBtn">
                            <i class="fa-solid fa-gear"></i> Settings
                        </button>
                        <button class="nav-btn logout-btn" id="logoutBtn">
                            <i class="fa-solid fa-right-from-bracket"></i> Logout
                        </button>
                    </div>
                    <button class="user-card user-toggle" id="userToggleBtn">
                        <div class="user-avatar">YS</div>
                        <div class="user-info">
                            <span class="name">Logged In</span>
                            <span class="role">User</span>
                        </div>
                        <i class="fa-solid fa-chevron-up user-chevron" id="userChevron"></i>
                    </button>
                </div>
            </div>
        </aside>

        <main class="main-content" id="mainContent">

            <header class="top-header" id="topHeader">
                <div class="header-titles">
                    <h1>Workspace</h1>
                </div>
                <div class="header-actions">

                    <div class="theme-wrapper">
                        <button id="themeBtn" class="theme-orb" title="Select Theme">
                            <i class="fa-solid fa-palette"></i>
                        </button>
                        <div class="theme-menu">
                            <button class="theme-option" data-idx="0"><i class="fa-solid fa-moon"></i> Nebula</button>
                            <button class="theme-option" data-idx="1"><i class="fa-solid fa-sun"></i> Daylight</button>
                            <button class="theme-option" data-idx="2"><i class="fa-solid fa-battery-quarter"></i>
                                Midnight</button>
                            <button class="theme-option" data-idx="3"><i class="fa-solid fa-terminal"></i>
                                Hacker</button>
                            <button class="theme-option" data-idx="4"><i class="fa-solid fa-fire"></i> Sunset</button>
                        </div>
                    </div>

                    <button class="action-btn secondary" id="focusSoundBtn" title="Toggle Deep Focus Noise">
                        <i class="fa-solid fa-wave-square"></i>
                    </button>

                    <button class="action-btn secondary" id="focusBtn" title="Focus Mode">
                        <i class="fa-solid fa-expand"></i>
                    </button>

                    <button class="action-btn secondary" id="chatToggleBtn" title="Chat with Note">
                        <i class="fa-solid fa-comments"></i> Chat
                    </button>

                    <button class="action-btn secondary" id="pdfBtn" title="Export PDF">
                        <i class="fa-solid fa-file-pdf"></i> PDF
                    </button>

                    <button class="action-btn primary" id="processBtn">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> Refine
                    </button>
                </div>
            </header>

            <div class="workspace" id="workspace">

                <div class="panel input-panel" id="inputPanel">
                    <div class="panel-head">
                        <div class="head-left">
                            <span class="panel-title"><i class="fa-regular fa-keyboard"></i> Input</span>
                        </div>
                        <!-- Converted onclick="setTemplate(...)" to data-action so they're ready
                             to be wired up in JS without calling an undefined function -->
                        <div class="template-bar">
                            <button class="chip" data-action="general">General</button>
                            <button class="chip" id="flashcardChip">Flashcard</button>
                            <button class="chip" data-action="code">Code</button>
                            <button class="chip" data-action="math">Math</button>
                        </div>
                    </div>
                    <textarea id="userInput" placeholder="Paste your educational content here to refine..."></textarea>
                    <div class="panel-footer" id="inputFooter">
                        <span class="status-indicator" id="inputStats">0 words</span>
                    </div>
                </div>

                <div class="resize-handler" id="resizeHandler" title="Drag to resize"></div>

                <div class="panel output-panel" id="outputPanel">
                    <div class="panel-head">
                        <span class="panel-title"><i class="fa-solid fa-robot"></i> AI Summary</span>
                        <div class="panel-actions">
                            <button class="icon-btn" id="saveNoteBtn" title="Save to Notebook">
                                <i class="fa-regular fa-bookmark"></i>
                            </button>
                            <button class="icon-btn" id="copyBtn" title="Copy Text">
                                <i class="fa-regular fa-copy"></i>
                            </button>
                        </div>
                    </div>

                    <div id="aiOutput" class="markdown-content empty-state">
                        <i class="fa-solid fa-sparkles"></i>
                        <p>Ready for refinement</p>
                    </div>

                    <div class="audio-player">
                        <div class="audio-info">
                            <i class="fa-solid fa-podcast"></i>
                            <span>Podcast Mode</span>
                        </div>
                        <div class="audio-controls">
                            <select id="voiceSelect" class="voice-select"></select>
                            <button class="audio-btn" id="stopAudioBtn"><i class="fa-solid fa-stop"></i></button>
                            <button class="audio-btn main-play" id="playAudioBtn"><i
                                    class="fa-solid fa-play"></i></button>
                            <button class="audio-btn speed" id="speedBtn">1x</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="floatingMenu" class="floating-menu hidden">
                <button class="float-btn" data-action="rewrite"><i class="fa-solid fa-wand-magic-sparkles"></i>
                    Rewrite</button>
                <button class="float-btn" data-action="summarize"><i class="fa-solid fa-list"></i> Summarize</button>
                <button class="float-btn" data-action="explain"><i class="fa-solid fa-code"></i> Explain</button>
                <button class="float-btn" data-action="read"><i class="fa-solid fa-volume-high"></i> Read</button>
            </div>

            <button id="exitFocusBtn" class="hidden"><i class="fa-solid fa-compress"></i> Exit Focus</button>

            <div id="chatSidebar" class="chat-sidebar">
                <div class="chat-header">
                    <h3><i class="fa-solid fa-robot"></i> Note Assistant</h3>
                    <button id="closeChatBtn" class="icon-btn"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div id="chatMessages" class="chat-messages">
                    <div class="chat-msg ai">Hi! I've read your note. What would you like to know?</div>
                </div>
                <div class="chat-input-area">
                    <input type="text" id="chatInput" placeholder="Ask a question..." autocomplete="off">
                    <button id="sendChatBtn"><i class="fa-solid fa-paper-plane"></i></button>
                </div>
            </div>

        </main>
    </div>

    <!-- ==================== CMD PALETTE ==================== -->
    <div id="cmdPalette" class="palette-overlay hidden">
        <div class="palette-modal">
            <div class="palette-search">
                <i class="fa-solid fa-magnifying-glass"></i>
                <input type="text" id="cmdInput" placeholder="Type a command..." autocomplete="off">
                <span class="palette-shortcut">Esc</span>
            </div>
            <div class="palette-results" id="cmdResults"></div>
            <div class="palette-footer">
                <span><kbd>‚Üë‚Üì</kbd> Navigate</span>
                <span><kbd>‚Üµ</kbd> Select</span>
            </div>
        </div>
    </div>

    <!-- ==================== SETTINGS MODAL ==================== -->
    <!-- Moved inline width/padding to .settings-card rule in CSS -->
    <div id="settingsModal" class="palette-overlay hidden">
        <div class="palette-modal settings-card glass-panel">
            <div class="settings-header">
                <h2><i class="fa-solid fa-sliders"></i> App Preferences</h2>
                <button id="closeSettingsBtn" class="icon-btn"><i class="fa-solid fa-xmark"></i></button>
            </div>

            <div class="settings-body">
                <div class="setting-group">
                    <label>AI System Prompt (Custom Instructions)</label>
                    <textarea id="settingPrompt" rows="3"
                        placeholder="E.g., You are an expert tutor. Summarize clearly..."></textarea>
                    <!-- Moved inline style to .setting-hint class -->
                    <small class="setting-hint">This tells the AI how to act. It gets sent with every request.</small>
                </div>

                <!-- Moved inline margin-top to .setting-group-spaced class -->
                <div class="setting-group setting-group-spaced">
                    <label>Change Password</label>
                    <input type="password" id="currentPassword" placeholder="Current Password">
                    <input type="password" id="newPassword" placeholder="New Password">
                    <input type="password" id="confirmNewPassword" placeholder="Confirm New Password">
                    <!-- Moved inline margin-top to .setting-submit-btn class -->
                    <button id="changePasswordBtn" class="login-btn fluid-gradient setting-submit-btn">
                        Update Password
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== FLASHCARD CONFIG MODAL ==================== -->
    <div id="fcOverlay" class="fc-overlay hidden">
        <div class="fc-modal" id="fcModal">

            <!-- STEP: CONFIG -->
            <div id="fcStepConfig">
                <div class="fc-modal-header">
                    <div class="fc-modal-title">Create Flashcards</div>
                    <div class="fc-modal-sub">Configure your study session</div>
                </div>
                <div class="fc-modal-body">
                    <div class="fc-form-group">
                        <label class="fc-label">Number of Cards</label>
                        <div class="fc-preset-row">
                            <button class="fc-preset-btn fc-selected" data-val="10">10</button>
                            <button class="fc-preset-btn" data-val="20">20</button>
                            <button class="fc-preset-btn" data-val="30">30</button>
                        </div>
                    </div>
                    <div class="fc-form-group">
                        <label class="fc-label">Topic</label>
                        <input class="fc-input" id="fcTopic" type="text"
                            placeholder="e.g. Microeconomics, Roman History‚Ä¶" maxlength="100">
                        <span class="fc-error hidden" id="fcTopicError">Topic is required</span>
                    </div>
                    <div class="fc-form-group">
                        <label class="fc-label">Difficulty</label>
                        <div class="fc-pill-row" id="fcDiffRow">
                            <button class="fc-pill-btn" data-val="Beginner">Beginner</button>
                            <button class="fc-pill-btn fc-pill-selected" data-val="Intermediate">Intermediate</button>
                            <button class="fc-pill-btn" data-val="Advanced">Advanced</button>
                        </div>
                    </div>
                    <div class="fc-form-group">
                        <label class="fc-label">Card Type</label>
                        <div class="fc-pill-row" id="fcTypeRow">
                            <button class="fc-pill-btn" data-val="Q&A Definition">Q&A Definition</button>
                            <button class="fc-pill-btn" data-val="Conceptual">Conceptual</button>
                            <button class="fc-pill-btn fc-pill-selected" data-val="Mixed">Mixed</button>
                        </div>
                    </div>
                </div>
                <div class="fc-modal-footer">
                    <button class="fc-btn fc-btn-ghost" id="fcCancelBtn">Cancel</button>
                    <button class="fc-btn fc-btn-ghost" id="fcViewSavedBtn">üìÇ Saved</button>
                    <button class="fc-btn fc-btn-primary" id="fcGenerateBtn">Generate ‚Üí</button>
                </div>
            </div>

            <!-- STEP: LOADING -->
            <div id="fcStepLoading" class="hidden">
                <div class="fc-loading-wrap">
                    <div class="fc-spinner"></div>
                    <div class="fc-loading-msg">Generating <strong id="fcLoadCount"></strong> flashcards on<br><strong
                            id="fcLoadTopic"></strong>‚Ä¶</div>
                </div>
            </div>

            <!-- STEP: ERROR -->
            <div id="fcStepError" class="hidden">
                <div class="fc-error-wrap">
                    <div class="fc-error-icon">‚ö†</div>
                    <div class="fc-error-msg" id="fcErrorMsg">Generation failed. Please try again.</div>
                    <button class="fc-btn fc-btn-primary" id="fcRetryBtn">‚Üª Retry</button>
                    <button class="fc-btn fc-btn-ghost fc-btn-sm" id="fcBackBtn">‚Üê Back</button>
                </div>
            </div>

        </div>
    </div>

    <!-- ==================== FLASHCARD REVIEW SCREEN ==================== -->
    <div id="fcReviewScreen" class="fc-fullscreen hidden">
        <div class="fc-review-wrap">
            <div class="fc-review-header">
                <div>
                    <div class="fc-review-title">Review Your Flashcards</div>
                    <div class="fc-review-meta" id="fcReviewMeta"></div>
                </div>
                <div class="fc-review-actions">
                    <button class="fc-btn fc-btn-ghost" id="fcRegenBtn">‚Üª Regenerate All</button>
                    <button class="fc-btn fc-btn-ghost" id="fcSaveBtn">üîñ Save Deck</button>
                    <button class="fc-btn fc-btn-primary" id="fcStartBtn">Start Flashcards ‚Üí</button>
                </div>
            </div>
            <div class="fc-card-list" id="fcCardList"></div>
        </div>
    </div>

    <!-- ==================== FLASHCARD MODE ==================== -->
    <div id="fcModeScreen" class="fc-fullscreen hidden">
        <div class="fc-topbar">
            <div class="fc-topbar-left">
                <span class="fc-topic-label" id="fcTopicLabel"></span>
                <span class="fc-progress-text" id="fcProgressText"></span>
            </div>
            <div class="fc-progress-bar">
                <div class="fc-progress-fill" id="fcProgressFill"></div>
            </div>
            <button class="fc-btn fc-btn-ghost fc-btn-sm" id="fcExitBtn">Exit</button>
        </div>

        <!-- Desktop two-pane -->
        <div class="fc-panes" id="fcPanes">
            <div class="fc-left">
                <div class="fc-card" id="fcCardBox">
                    <div class="fc-card-q" id="fcCardQ"></div>
                </div>
                <div class="fc-nav-btns">
                    <button class="fc-nav-btn" id="fcPrevBtn">‚Üê Prev</button>
                    <button class="fc-show-btn" id="fcShowBtn">Show Answer</button>
                    <button class="fc-nav-btn" id="fcNextBtn">Next ‚Üí</button>
                </div>
            </div>
            <div class="fc-right" id="fcRight">
                <div class="fc-right-empty" id="fcRightEmpty">
                    <div class="fc-right-empty-icon">üí°</div>
                    <span>Click "Show Answer" to reveal</span>
                </div>
                <div id="fcAnswerBlock" class="hidden">
                    <div class="fc-answer-section">
                        <div class="fc-answer-label">Answer</div>
                        <div class="fc-answer-card">
                            <div class="fc-answer-text" id="fcAnswerText"></div>
                        </div>
                    </div>
                    <div class="fc-answer-section" id="fcExplSection">
                        <div class="fc-answer-label">Explanation</div>
                        <div class="fc-answer-text" id="fcExplText"></div>
                    </div>
                    <div class="fc-answer-section" id="fcHintSection">
                        <div class="fc-answer-label">Memory Aid</div>
                        <div class="fc-answer-card">
                            <div class="fc-answer-text fc-hint-text" id="fcHintText"></div>
                        </div>
                    </div>
                    <div class="fc-rating-section">
                        <div class="fc-answer-label">How did you do?</div>
                        <div class="fc-rating-btns">
                            <button class="fc-rating-btn fc-got" data-rating="got">‚úì Got it</button>
                            <button class="fc-rating-btn fc-almost" data-rating="almost">~ Almost</button>
                            <button class="fc-rating-btn fc-missed" data-rating="missed">‚úó Missed</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile single-pane -->
        <!-- Moved padding inline styles to CSS classes .fc-mobile-answer-text, .fc-mobile-rating-wrap -->
        <div class="fc-mobile" id="fcMobile">
            <div class="fc-mobile-card" id="fcMobileCard"></div>
            <button class="fc-show-btn" id="fcMobileShowBtn">Show Answer</button>
            <div id="fcMobileAnswer" class="hidden fc-answer-text fc-mobile-answer-text"></div>
            <div class="fc-rating-btns fc-mobile-rating-wrap" id="fcMobileRating" style="display:none;">
                <button class="fc-rating-btn fc-got" data-rating="got">‚úì Got it</button>
                <button class="fc-rating-btn fc-almost" data-rating="almost">~ Almost</button>
                <button class="fc-rating-btn fc-missed" data-rating="missed">‚úó Missed</button>
            </div>
            <div class="fc-mobile-nav">
                <button class="fc-nav-btn" id="fcMobilePrev">‚Üê Prev</button>
                <button class="fc-nav-btn" id="fcMobileNext">Next ‚Üí</button>
            </div>
        </div>
    </div>

    <!-- ==================== SESSION SUMMARY ==================== -->
    <div id="fcSummaryScreen" class="fc-fullscreen hidden">
        <div class="fc-summary-wrap">
            <div>
                <div class="fc-summary-title">Session Complete üéâ</div>
                <div class="fc-summary-sub" id="fcSummarySub"></div>
            </div>
            <div class="fc-summary-stats">
                <div class="fc-stat-card fc-stat-got">
                    <span class="fc-stat-num" id="fcGotNum">0</span>
                    <span class="fc-stat-label">Got It</span>
                </div>
                <div class="fc-stat-card fc-stat-almost">
                    <span class="fc-stat-num" id="fcAlmostNum">0</span>
                    <span class="fc-stat-label">Almost</span>
                </div>
                <div class="fc-stat-card fc-stat-missed">
                    <span class="fc-stat-num" id="fcMissedNum">0</span>
                    <span class="fc-stat-label">Missed</span>
                </div>
            </div>
            <div class="fc-summary-actions">
                <button class="fc-btn fc-btn-primary hidden" id="fcReviewMissedBtn">Review Missed Cards</button>
                <button class="fc-btn fc-btn-ghost" id="fcRestartBtn">Start Over</button>
                <button class="fc-btn fc-btn-ghost" id="fcSummaryExitBtn">Exit</button>
            </div>
        </div>
    </div>

    <!-- ==================== EXIT WARNING MODAL ==================== -->
    <!-- Moved inline text-align/padding styles to .fc-exit-header and .fc-exit-footer classes -->
    <div id="fcExitOverlay" class="fc-overlay hidden">
        <div class="fc-modal fc-exit-modal">
            <div class="fc-modal-header fc-exit-header">
                <div class="fc-exit-icon">‚ö†Ô∏è</div>
                <div class="fc-modal-title">Exit Flashcard Mode?</div>
                <div class="fc-modal-sub">You'll lose your current progress and remaining cards.</div>
            </div>
            <div class="fc-modal-footer fc-exit-footer">
                <button class="fc-btn fc-btn-ghost" id="fcExitCancelBtn">Cancel</button>
                <button class="fc-btn fc-btn-danger" id="fcExitConfirmBtn">Continue & Exit</button>
            </div>
        </div>
    </div>
    <!-- ==================== SAVED FLASHCARD DECKS ==================== -->
    <div id="fcSavedScreen" class="fc-fullscreen hidden">
        <div class="fc-review-wrap">
            <div class="fc-review-header">
                <div>
                    <div class="fc-review-title">Saved Decks</div>
                    <div class="fc-review-meta">Click a deck to load it</div>
                </div>
                <button class="fc-btn fc-btn-ghost" id="fcSavedCloseBtn">‚úï Close</button>
            </div>
            <div id="fcSavedList"></div>
        </div>
    </div>
    <div id="toast" class="toast">Action Complete</div>
    <script src="script.js"></script>
</body>

</html>